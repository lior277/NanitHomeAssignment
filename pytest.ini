[pytest]
# =============================================================================
# Test Discovery
# =============================================================================
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# =============================================================================
# Command-line Options
# =============================================================================
addopts =
    # Verbosity and output
    -v
    --tb=short
    --strict-markers
    -ra

    # HTML reporting
    --html=infra/reports/report.html
    --self-contained-html

    # Coverage (optional - uncomment to enable)
    # --cov=infra
    # --cov-report=html:infra/reports/coverage
    # --cov-report=term-missing

    # Performance
    --durations=10

# =============================================================================
# Custom Markers
# =============================================================================
markers =
    # Stage 1 - Streaming
    streaming: Streaming validation tests (API layer with mock server)

    # Stage 2 - Mobile
    mobile: Mobile testing tests (mock Appium session)

    # Test Types
    smoke: Smoke tests for quick validation
    regression: Regression tests for comprehensive coverage
    critical: Critical path tests that must always pass
    integration: Integration tests across multiple layers

    # Technical Markers
    asyncio: Async tests requiring asyncio support (auto-added for coroutines)
    slow: Tests that take longer than 5 seconds
    requires_network: Tests that require external network access
    requires_device: Tests that require real mobile device

# =============================================================================
# Asyncio Configuration
# =============================================================================
asyncio_mode = auto

# =============================================================================
# Logging Configuration
# =============================================================================
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] [%(name)s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# File logging
log_file = infra/reports/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] [%(name)s:%(lineno)d] %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# =============================================================================
# Output Styling
# =============================================================================
console_output_style = progress

# =============================================================================
# Warning Filters
# =============================================================================
filterwarnings =
    # Ignore deprecation warnings from third-party libraries
    ignore::DeprecationWarning:appium.*
    ignore::DeprecationWarning:selenium.*
    # Convert our own warnings to errors
    error::UserWarning:infra.*

# =============================================================================
# Test Execution
# =============================================================================
# Set timeout for tests (requires pytest-timeout)
# timeout = 300
# timeout_method = thread

# Fail on first error (useful for debugging)
# -x

# Run tests in parallel (requires pytest-xdist)
# -n auto

# =============================================================================
# Minimum Python Version
# =============================================================================
minversion = 3.10

# =============================================================================
# Test Collection
# =============================================================================
# Ignore these directories during test collection
norecursedirs =
    .git
    .venv
    venv
    env
    __pycache__
    *.egg-info
    build
    dist
    node_modules

# =============================================================================
# JUnit XML Output (for CI/CD)
# =============================================================================
# junit_family = xunit2
# junit_suite_name = Nanit QA Automation

# =============================================================================
# Custom Ini Options (for parameterization)
# =============================================================================
[pytest:ini_options]
# Add custom ini values here if needed